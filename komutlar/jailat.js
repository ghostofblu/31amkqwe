const Discord = require("discord.js");
const ms = require("ms");
const frapuhin = require('../frapuhin.json');
let db = require('quick.db')

module.exports.run = async (client, message, args) => {
let rol = message.guild.roles.get(frapuhin.jailrolu)
let yetkili = message.guild.roles.get(frapuhin.jailhammer)
let kanal = message.guild.channels.get(frapuhin.cezabilgikanal)
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
if(!message.member.roles.get(frapuhin.jailhammer) && !message.member.hasPermission('ADMINISTRATOR') && !message.member.roles.get(frapuhin.tacsahipleri)) return message.channel.send(`Bu komutu kullanmaya erişimin yok`).then(msg => msg.delete(4000))
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
let kişi = message.guild.member(message.mentions.users.first() || message.guild.members.get(args[0]));
let zaman = args[1]
let sebep = args.join(' ').slice(args[1].length+args[0].length + 1)
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
let mutetime = args[1].replace(`saniye`, `s`).replace(`dakika`, `m`).replace(`saat`, `h`).replace(`gün`, `d`).replace(`hafta`, `w`)
let vakit = mutetime.replace("m", " Dakika").replace("s", " Saniye").replace("h", " Saat").replace("d", " Gün").replace("w", " Hafta")
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
if(!kişi) return message.channel.send(`Kimi jaile atıcaksın? Etiketlemeyi unutma.`)
if(!args[1]) return message.channel.send(`Bir jail süresi girmelisin! | Seçeneklerin; 1s/1m/1h/1d/1w`)
if(!sebep) sebep = 'Sebep Belirtmemiş'
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
const jailBasladi = new Discord.RichEmbed()
.setAuthor(message.author.username, message.author.avatarURL)
.setDescription(`${kişi} Kullanıcısı **${message.author.username}#${message.author.discriminator}** Tarafından Hapishaneye Sürüklendi.\n───────────────\nCezalı Süresi: **${zaman.replace(/d/, ' Gün').replace(/s/, ' Saniye').replace(/m/, ' Dakika').replace(/h/, ' Saat').replace(/w/, ' Hafta')}**\nCezalı Nedeni: **${sebep}**\nCezalı Atılan Kanal: **<#${message.channel.id}>**`)
.setTimestamp()
.setColor(0x00000);
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
let jailBitti = new Discord.RichEmbed()
.setTitle(`Hapishane Cezası | Süresi Doldu`)
.setDescription(`**${kişi}** Kullanıcısının Jail Yediği **${sebep}** Cezası Sona Ermiştir. <${frapuhin.tikemoji}>`)
.setFooter(`${client.user.tag}`, client.user.avatarURL)
.setColor('GREEN');
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  kişi.addRole(rol.id);
    kişi.roles.forEach(r => {
kişi.removeRole(r.id)
db.set(`${message.guild.id}.jail.${kişi.id}.roles.${r.id}`, r.id )})
    db.set(`${message.guild.id}.jail.${kişi.id}`, 'Frapuhin')
    kanal.send(jailBasladi)
    setTimeout(async () =>{
    kişi.removeRole(rol.id)
    kanal.send(jailBitti)
  }, ms(zaman));
            setTimeout(async () =>{
message.guild.roles.forEach(async r => {
const i = await db.fetch(`${message.guild.id}.jail.${kişi.id}.roles.${r.id}` )
if(i != r.id)  return ;
if(i){kişi.addRole(i)}
db.delete(`${message.guild.id}.jail.${kişi.id}.roles.${r.id}`)
})
          db.delete(`${message.guild.id}.jail.${kişi.id}`)
              }, ms(zaman));
}
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
exports.conf = {
    enabled: true,
    guildOnly: false,
    aliases: ['jail', "hapis", "hapishane", "ceza", "cezali", "cezalı"],
    permLevel: 0
  };
  
exports.help = {
 name: 'jail',
 description: 'Bir kişiyi belirlediğiniz rol ile jaile yollarsınız.',
 usage: 'jail @üye <10s,10m,10h,10d> sebep',
 kategori: '**MODERASYON**',
 permLvl: ''
};